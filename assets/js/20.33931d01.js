(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{376:function(s,t,a){"use strict";a.r(t);var n=a(14),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"_1-面试题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-面试题"}},[s._v("#")]),s._v(" 1.面试题")]),s._v(" "),t("ol",[t("li",[s._v("阿里广告平台，海量数据里查询某一固定前缀的key")]),s._v(" "),t("li",[s._v("小红书，你如何生产上限制keys */flushdb/flushall等危险命令以防止误删误用？")]),s._v(" "),t("li",[s._v("美团，MEMORY USAGE 命令你用过吗？")]),s._v(" "),t("li",[s._v("BigKey问题，多大算big？你如何发现？如何删除？如何处理？")]),s._v(" "),t("li",[s._v("BigKey你做过调优吗？惰性释放lazyfree了解过吗?")]),s._v(" "),t("li",[s._v("Morekey问题，生产上redis数据库有1000W记录，你如何遍历？key *可以吗?")])]),s._v(" "),t("h2",{attrs:{id:"_2-morekey案例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-morekey案例"}},[s._v("#")]),s._v(" 2.MoreKey案例")]),s._v(" "),t("h3",{attrs:{id:"_2-1-大批量往redis里面插入2000w测试数据key"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-大批量往redis里面插入2000w测试数据key"}},[s._v("#")]),s._v(" 2.1 大批量往redis里面插入2000W测试数据key")]),s._v(" "),t("p",[s._v("根据电脑性能调整")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("// 生成数据\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"set k'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" tmp/redisTest.txt "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n// 插入数据\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" tmp/redisTest.txt "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" src/redis-7.0.0/src/redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" 123456abc "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--pipe")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"_2-2-keys等命令的使用和禁用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-keys等命令的使用和禁用"}},[s._v("#")]),s._v(" 2.2 keys等命令的使用和禁用")]),s._v(" "),t("p",[t("strong",[s._v("keys * 你试试100W花费多少秒遍历查询")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409102239107.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409102239585.png",alt:""}})]),s._v(" "),t("p",[s._v("key * 这个指令有致命的弊端，在实际环境中最好不要使用")]),s._v(" "),t("p",[t("strong",[s._v("限制")])]),s._v(" "),t("p",[s._v("生产上限制"),t("code",[s._v("keys */flushdb/flushall")]),s._v("等危险命令以防止误删误用？")]),s._v(" "),t("p",[s._v("通过配置设置禁用这些命令，redis.conf在SECURITY这一项中")]),s._v(" "),t("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409102242204.png"}}),s._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409102242220.png"}}),s._v(" "),t("h3",{attrs:{id:"_2-3-不用keys-避免卡顿-那该用什么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-不用keys-避免卡顿-那该用什么"}},[s._v("#")]),s._v(" 2.3 不用keys *避免卡顿，那该用什么")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("scan命令登场")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://redis.io/commands/scan/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://redis.io/commands/scan/"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://redis.com.cn/commands/scan.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://redis.com.cn/commands/scan.html"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.runoob.com/redis/keys-scan.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Redis SCAN 命令 | 菜鸟教程 (runoob.com)"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("一句话，类似mysql limit的"),t("strong",[s._v("但不完全相同")])])])]),s._v(" "),t("li",[t("p",[s._v("SCAN 命令是一个基于游标的迭代器，每次被调用之后， 都会向用户返回一个新的游标， 用户在下次迭代时需要使用这个新游标作为 SCAN 命令的游标参数， 以此来延续之前的迭代过程。")]),s._v(" "),t("p",[s._v("SCAN 返回一个包含两个元素的数组，")]),s._v(" "),t("p",[s._v("第一个元素是用于进行下一次迭代的新游标， 第二个元素则是一个数组， 这个数组中包含了所有被迭代的元素。如果新游标返回零表示迭代已结束。")])]),s._v(" "),t("li",[t("p",[s._v("SCAN的遍历顺序")]),s._v(" "),t("p",[s._v("非常特别，它不是从第一维数组的第零位一直遍历到末尾，而是采用了高位进位加法来遍历。之所以使用这样特殊的方式进行遍历，是考虑到字典的扩容和缩容时避免槽位的遍历重复和遗漏。")])])]),s._v(" "),t("p",[s._v("使用")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("nps2-r:db"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" scan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" match k* count  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"212992"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k385339"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k2664"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k390224"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k370659"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k389840"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k346105"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k347177"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k452887"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k57626"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k248140"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k348208"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k334578"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k5605"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k497571"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k426935"')]),s._v("\nnps2-r:db"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" scan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("212992")]),s._v(" match k* count  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"73728"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k433414"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k56782"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k490717"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k320049"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k280000"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k433253"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k178110"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k445520"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k390957"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k119322"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k94856"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k158928"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k467993"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k140943"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k27801"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409102254993.png"}}),s._v(" "),t("h2",{attrs:{id:"_3-bigkey生产案例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-bigkey生产案例"}},[s._v("#")]),s._v(" 3.BigKey生产案例")]),s._v(" "),t("h3",{attrs:{id:"_3-1-多大算big"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-多大算big"}},[s._v("#")]),s._v(" 3.1 多大算Big")]),s._v(" "),t("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409112207820.png"}}),s._v(" "),t("ul",[t("li",[t("code",[s._v("string是value，最大512MB但是≥10KB就是bigkey")])]),s._v(" "),t("li",[s._v("list、hash、set和zset，个数超过5000就是bigkey")])]),s._v(" "),t("h3",{attrs:{id:"_3-2哪些危害"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2哪些危害"}},[s._v("#")]),s._v(" 3.2哪些危害")]),s._v(" "),t("ul",[t("li",[s._v("内存不均，集群迁移困难")]),s._v(" "),t("li",[s._v("超时删除，大key删除作梗")]),s._v(" "),t("li",[s._v("网络流量阻塞")])]),s._v(" "),t("h3",{attrs:{id:"_3-3-如何产生"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-如何产生"}},[s._v("#")]),s._v(" 3.3 如何产生")]),s._v(" "),t("ul",[t("li",[s._v("社交类: 王心凌粉丝列表，典型案例粉丝逐步递增")]),s._v(" "),t("li",[s._v("汇总统计:某个报表，月日年经年累月的积累")])]),s._v(" "),t("h3",{attrs:{id:"_3-4如何发现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4如何发现"}},[s._v("#")]),s._v(" 3.4如何发现")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("如何发现")]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("好处，见最下面总结")])]),s._v(" "),t("p",[s._v("给出每种数据结构Top 1 bigkey，同时给出每种数据类型的键值个数+平均大小")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("不足")])]),s._v(" "),t("p",[s._v("想查询大于10kb的所有key，--bigkeys参数就无能为力了，需要用到memory usage来计算每个键值的字节数")])])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bigkeys")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("111111")]),s._v(" \n\nredis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("111111")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bigkeys")]),s._v("\n\n每隔 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" 条 scan 指令就会休眠 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".1s，ops 就不会剧烈抬升，但是扫描的时间会变长\nredis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" –-bigkeys "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("\n\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409112211483.png"}})]),s._v(" "),t("li",[t("p",[s._v("MEMORY USAGE 键")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("计算每个键值的字节数")]),s._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409112212363.png"}})]),s._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://redis.com.cn/commands/memory-usage.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://redis.com.cn/commands/memory-usage.html"),t("OutboundLink")],1)])])])])]),s._v(" "),t("h3",{attrs:{id:"_3-5如何删除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-5如何删除"}},[s._v("#")]),s._v(" 3.5如何删除")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("参考《阿里云Redis开发规范》")]),s._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409112214586.png"}})]),s._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://redis.io/commands/scan/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),t("OutboundLink")],1)])]),s._v(" "),t("li",[t("p",[s._v("普通命令")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("String：一般用del，如果过于庞大unlink")])]),s._v(" "),t("li",[t("p",[s._v("hash")]),s._v(" "),t("ul",[t("li",[s._v("使用hscan每次获取少量field-value，再使用hdel删除每个field")]),s._v(" "),t("li",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409112216149.png",alt:""}})]),s._v(" "),t("li",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409112216200.png",alt:""}})])])]),s._v(" "),t("li",[t("p",[s._v("list")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("使用ltrim渐进式逐步删除，直到全部删除完成")])]),s._v(" "),t("li",[t("p",[s._v("命令")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409112217150.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409112218844.png",alt:""}})])]),s._v(" "),t("li",[t("p",[s._v("阿里")]),s._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409112218989.png"}})])])]),s._v(" "),t("li",[t("p",[s._v("set")]),s._v(" "),t("ul",[t("li",[s._v("使用sscan每次获取部分元素，再使用srem命令删除每个元素")]),s._v(" "),t("li",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409112219678.png",alt:""}})]),s._v(" "),t("li",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409112219324.png",alt:""}})])])]),s._v(" "),t("li",[t("p",[s._v("zset")]),s._v(" "),t("ul",[t("li",[s._v("使用zscan每次获取部分元素，再使用ZREMRANGEBYRANK命令删除每个元素")]),s._v(" "),t("li",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409112220121.png",alt:""}})]),s._v(" "),t("li",[t("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/2024091122redis20787.png"}})])])])])])]),s._v(" "),t("h2",{attrs:{id:"_4-bigkey调优"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-bigkey调优"}},[s._v("#")]),s._v(" 4.BigKey调优")]),s._v(" "),t("p",[t("strong",[s._v("redis.conf配置文件LAZY FREEING相关说明")])]),s._v(" "),t("ul",[t("li",[s._v("阻塞和非阻塞删除命令")])]),s._v(" "),t("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409112234073.png"}}),s._v(" "),t("ul",[t("li",[s._v("优化配置")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202409112234519.png",alt:""}})])])}),[],!1,null,null,null);t.default=e.exports}}]);